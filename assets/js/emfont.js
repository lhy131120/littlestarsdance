!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.emfont=e()}("undefined"!=typeof self?self:this,function(){class t{constructor(t={caseSensitive:!1,weight:null,format:"woff2",autoApply:!0,cache:!0,applyAt:document.head,colorTest:!1,root:document.documentElement,log:!1,hideAd:!1,forceMin:!1,tofu:!1}){this.config=t,this.config.hideAd||console.log("✏️ This website uses emfont: a free Chinese webfont service.")}_checkBrowserSupport(){return"function"==typeof FontFace&&"fonts"in document&&"function"==typeof Promise&&"function"==typeof class{}&&(()=>{}).constructor===Function&&Object.entries&&Array.prototype.includes}_hasWoff2Support(){try{return new FontFace("t",'url("data:font/woff2;base64,d09GMgABAAAAAADcAAoAAAAAAggAAACWAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAABk4ALAoUNAE2AiQDCAsGAAQgBSAHIBtvAcieB3aD8wURQ+TZazbRE9HvF5vde4KCYGhiCgq/NKPF0i6UIsZynbP+Xi9Ng+XLbNlmNz/xIBBqq61FIQRJhC/+QA/08PJQJ3sK") format("woff2")').load().then(()=>!0).catch(()=>!1)}catch(t){return!1}}fonts={};setConfig(t={}){this.config={...this.config,root:document.documentElement,...t}}_cyrb53(t,e=42){let o=3735928559^e,n=1103547991^e;for(let e,s=0;s<t.length;s++)e=t.charCodeAt(s),o=Math.imul(o^e,2654435761),n=Math.imul(n^e,1597334677);return o=Math.imul(o^o>>>16,2246822507),o^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(o^o>>>13,3266489909),4294967296*(2097151&n)+(o>>>0)}_createLocalStorageCacher(t=86400){const e="emfont-cache:";return{get(t){const o=localStorage.getItem(e+t);if(o){const t=JSON.parse(o);if("102"===t.version&&new Date(t.expiresAt)>new Date)return t.payload}return null},set(o,n){const s={version:"102",payload:n,expiresAt:new Date(Date.now()+1e3*t).toISOString()};localStorage.setItem(e+o,JSON.stringify(s))}}}async _fetchJson(t,e,o){const n=this._cyrb53(t+JSON.stringify(e)),s=o?.get(n);if(s)return s;const i=await fetch(t,e);if(!i.ok)throw new Error(`HTTP error ${i.status}`);const r=await i.json();return"status"in r&&"success"!==r.status||o?.set(n,r),r}init(t={}){let e={};return this.setConfig(t),new Promise(t=>{let o=Array.from(this.config.root.querySelectorAll("[class*='emfont']"));this.config.root.className.includes("emfont")&&o.unshift(this.config.root);let n=new Set;o.forEach(t=>{n.add(t),t.querySelectorAll("*").forEach(t=>{t.textContent.trim()&&n.add(t)})});let s=[];n.forEach(t=>{if(this.config.colorTest)return void(t.style.color="red");let o=null;for(let e=t;e;e=e.parentElement){const t=[...e.classList].find(t=>t.startsWith("emfont-")||t.startsWith("✏️"));if(t){o=t.replace(/^(emfont-|✏️)/,""),s.push(o);break}}if(!o)return;const n=getComputedStyle(t);let i=t.textContent.trim();switch(n.textTransform){case"uppercase":i=i.toUpperCase();break;case"lowercase":i=i.toLowerCase();break;case"capitalize":i=i.replace(/\b\w/g,t=>t.toUpperCase())}let r=o;if(!o.match(/-(\d+)/)){const t=n.fontWeight||this.config.weight||"";t&&"normal"!==t&&(r+=`-${t}`)}if(r&&i){const t=(e[r]||"")+i;e[r]=Array.from(new Set(t.split(""))).sort().join("")}}),this._styleElement||(this._styleElement=document.createElement("style"),this.config.autoApply&&this.config.applyAt.appendChild(this._styleElement));let i=[];this.config.cache&&Object.keys(this.fonts).forEach(t=>{e[t]&&(delete e[t],i.push({name:t,status:"skipped",reason:"Already loaded"}))});let r=[];Object.keys(e).forEach(t=>{r.push(t),this.fonts[t]?this.fonts[t]=Array.from(new Set((this.fonts[t]+e[t]).split(""))).sort().join(""):this.fonts[t]=e[t]});const c=Object.entries(e).map(([t,e])=>{let o=t;const n=this.config.forceMin||t.includes("-min");n&&(o=t.replace("-min",""));let i=t.match(/-(\d+)/);i&&(o=o.replace("-"+i[1],""),i=i[1]);const c=this.config.tofu?", 'Tofu'":"",a=!n&&this.config.cache?this._createLocalStorageCacher(86400):null;return this._fetchJson("https://font.emtech.cc/g/"+o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({words:e+" ",min:n,weight:i,format:this.config.format})},a).then(async e=>{if("success"===e.status){e.message&&console.warn("✏️ "+e.message);const o=e.name;if(this.config.autoApply&&r.includes(t)){const e=t.split("-")[0],n=s.filter(t=>t.startsWith(e));0===n.length&&n.push(e);const i=[...new Set(n)];this._styleElement.innerHTML+="\n"+i.map(t=>{const e=t.match(/-(\d+)/)?t.match(/-(\d+)/)[1]:"normal";return`.emfont-${t},.✏️${t}{font-family:'${o}'${c};font-weight:${e}}`}).join("\n")}for(const t of e.location){const e=new FontFace(o,`url(${t})`,{weight:i||this.config.weight||"normal"});try{const t=await e.load();document.fonts.add(t)}catch(e){console.warn(`✏️ Failed to load font from: ${t}`,e)}}return{name:t,status:"fulfilled"}}return{name:t,status:"rejected",reason:e.message}}).catch(e=>({name:t,status:"rejected",reason:e.message}))});Promise.all(c).then(e=>{e=[...e,...i];let o=this._styleElement.innerHTML.split("\n").filter((t,e,o)=>o.indexOf(t)===e);this._styleElement.innerHTML=o.join("\n"),this.config.log&&e.forEach(t=>{"fulfilled"===t.status?console.log(`✅ ${t.name} loaded successfully`):console.warn(`❌ ${t.name} failed: ${t.reason}`)}),t(e)})})}}const e=new t;return e.Emfont=t,e});